import{_ as V}from"./CardComponent.vue_vue_type_style_index_0_lang-5b0029ab.js";import{d as r,o as l,c as m,f as u,t as x,j as D,k as b,n as j,u as _,C as H,a as i,b as C,w as A,r as F,F as S,D as z,g as c,i as L,e as k,T as J,q as O,v as M,E as P,x as G,y as q,m as B,l as Q,p as X,z as Y}from"./index-8b280c30.js";import{_ as Z,a as ee,u as ae}from"./useAxios-5e6bb7b6.js";import{e as K,b as I,p as W,_ as se}from"./LoaderComponent.vue_vue_type_style_index_0_lang-07c726db.js";import{u as te,a as ne}from"./useBlurHandle-29fc9f62.js";import{_ as le,a as oe}from"./CardDivider.vue_vue_type_style_index_0_lang-d3f03ffa.js";import"./_plugin-vue_export-helper-c27b6911.js";const me={class:"chat__head"},ie={class:"chat__name"},ue={class:"chat__info"},re=u("i",{class:"fa fa-users"},null,-1),ce=u("i",{class:"fa fa-comment"},null,-1),_e=r({__name:"RoomHead",props:{members:null,room:null,msgNum:null},setup(a){return(s,e)=>{var t,n;return l(),m("div",me,[u("div",ie,[u("span",null,x((t=a.room)==null?void 0:t.name),1)]),u("div",ue,[u("span",null,[re,D(" "+x(a.members?a.members.length:(n=a.room)==null?void 0:n.members)+" / ",1),ce,D(" "+x(a.msgNum),1)])])])}}});function de(a){const s=["##99ccff","#99ffff","#ffdb4d","#b3ff66","#66ff66","#80b3ff","#ff66b3","#ff66a3","#a366ff","#66ffb3"];let e=0;return a.split("").map(t=>e+=t.charCodeAt(0)),e=e%10,{backgroundColor:s[e]}}const ve={class:"msg__author__name"},ge=r({__name:"MessageAuthor",props:{author:null,isOnline:{type:Boolean}},setup(a){const s=a,e=b(()=>s.isOnline?"msg__author__status--online":"msg__author__status--offline");return(t,n)=>(l(),m("div",{class:"msg__author",style:H(_(de)(a.author.username))},[u("span",null,x(a.author.username.charAt(0).toUpperCase()),1),u("div",ve,x(a.author.username),1),u("div",{class:j(["msg__author__status",_(e)])},null,2)],4))}});const pe=["innerHTML"],fe=r({__name:"MessageText",props:{text:null,isAuthor:{type:Boolean}},setup(a){const s=a,e=b(()=>s.isAuthor?" msg__text--mine":"msg__text--their");return(t,n)=>(l(),m("div",{class:j(["msg__text",_(e)]),innerHTML:a.text},null,10,pe))}});function ye(a){if(!a)return"";const s=new Date(a),e=Math.floor((Date.now().valueOf()-s.valueOf())/1e3/86400),t=(new Date().getTime()-s.valueOf())/1e3;return isNaN(e)||e<0?"":e===0&&(t<60&&"только что"||t<120&&"минуту назад"||t<3600&&Math.floor(t/60)+" мин. назад"||t<7200&&"час назад"||t<86400&&Math.floor(t/3600)+" час. назад")||e===1&&"день назад"||e<5&&e+" дня назад"||e<7&&e+" дней назад"||e<14&&"неделю назад"||e<21&&"2 недели назад"||e<31&&"3 недели назад"||e===31&&e+" месяц назад"||e<365&&Math.floor(e/31)+" мес. назад"||e===365&&"год назад"||e>365&&"больше года назад"}const he={class:"msg__time"},be=r({__name:"MessageTime",props:{createdAt:null},setup(a){return(s,e)=>(l(),m("div",he,[u("span",null,x(_(ye)(a.createdAt)),1)]))}});const xe=r({__name:"MessageComponent",props:{message:null,members:null},setup(a){const s=a,e=localStorage.user,t=b(()=>s.members?s.members.includes(s.message.author.username):!1),n=b(()=>s.message.author.username===e),d=b(()=>n.value?"msg__message--mine":""),h=b(()=>n.value?"msg__body--mine":"");return(y,f)=>(l(),m("div",{class:j(["msg__message",_(d)])},[i(ge,{author:a.message.author,isOnline:_(t)},null,8,["author","isOnline"]),u("div",{class:j(["msg__body",_(h)])},[i(fe,{text:a.message.text,isAuthor:_(n)},null,8,["text","isAuthor"]),i(be,{createdAt:a.message.created_at},null,8,["createdAt"])],2)],2))}});const $e={class:"msg__notification"},we=r({__name:"InfoMessage",props:{message:null},setup(a){return(s,e)=>(l(),m("div",$e,[u("span",null,x(a.message.user)+" "+x(a.message.type==="join"?"входит в":"покидает")+" чат ",1)]))}});const ke={class:"msg"},je=r({__name:"MessageItem",props:{message:null,members:null},setup(a){return(s,e)=>(l(),m("li",ke,[a.message.type==="message"?(l(),C(xe,{key:0,message:a.message,members:a.members},null,8,["message","members"])):(l(),C(we,{key:1,message:a.message},null,8,["message"]))]))}}),Ce=r({__name:"MessageList",props:{messages:null,members:null},setup(a){return(s,e)=>(l(),C(z,{name:"list",class:"message-list",tag:"ul"},{default:A(()=>[(l(!0),m(S,null,F(a.messages,t=>(l(),C(je,{key:t.id,message:t,members:a.members},null,8,["message","members"]))),128))]),_:1}))}});const Me=["value"],Te=r({__name:"NewMessageTextarea",props:{value:null},setup(a,{expose:s}){const e=c();return s({textRef:e}),(t,n)=>(l(),m("textarea",{ref_key:"textRef",ref:e,name:"newMessage",id:"newMessage",placeholder:"Введите свое сообщение",value:a.value,onInput:n[0]||(n[0]=d=>t.$emit("changed",d.target.value))},null,40,Me))}}),Ne=["disabled"],Ee=u("i",{class:"fa fa-paper-plane"},null,-1),Ae=[Ee],Se=r({__name:"NewMessageButton",props:{isActive:{type:Boolean}},setup(a){const s=a,e=b(()=>s.isActive?"":"new-msg-form__submit-btn--disabled");return(t,n)=>(l(),m("button",{onClick:n[0]||(n[0]=d=>t.$emit("clicked")),class:j(["new-msg-form__submit-btn",_(e)]),"aria-label":"Отправить сообщение",disabled:!a.isActive},Ae,10,Ne))}});const Be="/dist/emojis/7.png",Le=r({__name:"EmojisButton",props:{isWindowOpened:{type:Boolean}},setup(a){const s=a,e=b(()=>s.isWindowOpened?"new-msg-form__emoji--active":"");return(t,n)=>(l(),m("button",{class:"new-msg-form__emoji-btn",onClick:n[0]||(n[0]=d=>t.$emit("clicked")),"aria-label":"Выбрать эмодзи"},[u("img",{class:j(["new-msg-form__emoji",_(e)]),src:Be,alt:"🙂"},null,2)]))}});const Oe=[{name:"смеющееся лицо с большими глазами",alt:"😃"},{name:"хохочущее лицо со смеющимися глазами",alt:"😄"},{name:"сияющее лицо со смеющимися глазами",alt:"😁"},{name:"хохочущее лицо с сощуренными глазами",alt:"😆"},{name:"лицо, катающееся по полу от смеха",alt:"🤣"},{name:"лицо со слезами радости",alt:"😂"},{name:"лицо с легкой улыбкой",alt:"🙂"},{name:"лицо, перевернутое вверх ногами",alt:"🙃"},{name:"подмигивающее лицо",alt:"😉"},{name:"улыбающееся лицо",alt:"☺️"},{name:"улыбающееся лицо с нимбом",alt:"😇"},{name:"улыбающееся лицо с сердечками",alt:"🥰"},{name:"улыбающееся лицо с глазами в виде сердечек",alt:"😍"},{name:"лицо со звездами вместо глаз",alt:"🤩"},{name:"воздушный поцелуй",alt:"😘"},{name:"целующее лицо",alt:"😗"},{name:"целующее лицо с закрытыми глазами",alt:"😚"},{name:"улыбка сквозь слезы",alt:"🥲"},{name:"лицо смакующее еду",alt:"😋"},{name:"лицо, показывающее язык",alt:"😛"},{name:"подмигывающее лицо, показывающее язык",alt:"😜"},{name:"дурачащееся лицо",alt:"🤪"},{name:"лицо с сощуренными глазами и высунутым языком",alt:"😝"},{name:"лицо с долларами в глазах",alt:"🤑"},{name:"обнимашки",alt:"🤗"},{name:"лицо прикрывающее рот рукой",alt:"🤭"},{name:"шикающее лицо",alt:"🤫"},{name:"размышляющее лицо",alt:"🤔"},{name:"рот на замке",alt:"🤐"},{name:"лицо с приподнятой бровью",alt:"🤨"},{name:"недовольное лицо",alt:"😒"},{name:"лицо закатившее глаза",alt:"🙄"},{name:"гримасничающее лицо",alt:"😬"},{name:"обманщик",alt:"🤥"},{name:"лицо, испытывающее облегчение",alt:"😌"},{name:"меланхоличное лицо",alt:"😞"},{name:"сонное лицо",alt:"😪"},{name:"нейтральное лицо",alt:"😐"},{name:"лицо без рта",alt:"😶"},{name:"ухмыляющееся лицо",alt:"😏"},{name:"лицо, пускающее слюни",alt:"🤤"},{name:"спящее лицо",alt:"😴"},{name:"лицо в медицинской маске",alt:"😷"},{name:"лицо с термометром",alt:"🤒"},{name:"лицо с повязкой на голове",alt:"🤕"},{name:"лицо, испытывающее тошноту",alt:"🤢"},{name:"лицо которое тошнит",alt:"🤮"},{name:"чихающее лицо",alt:"🤧"},{name:"распаренное лицо",alt:"🥵"},{name:"замерзшее лицо",alt:"🥶"},{name:"растерянное лицо",alt:"😕"},{name:"нетрезвое лицо",alt:"🥴"},{name:"ошеломленное лицо",alt:"😵"},{name:"взрыв мозга",alt:"🤯"},{name:"праздник",alt:"🥳"},{name:"лицо в ковбойской шляпе",alt:"🤠"},{name:"улыбающееся лицо в солнцезащитных очках",alt:"😎"},{name:"умник",alt:"🤓"},{name:"лицо с моноклем",alt:"🧐"},{name:"озабоченное лицо",alt:"😟"},{name:"слегка нахмуренное лицо",alt:"🙁"},{name:"хмурое лицо",alt:"☹️"},{name:"лицо с открытым ртом",alt:"😮"},{name:"притихшее лицо",alt:"😯"},{name:"удивленное лицо",alt:"😲"},{name:"покрасневшее лицо",alt:"😳"},{name:"умоляющее лицо",alt:"🥺"},{name:"хмурое лицо с открытым ртом",alt:"😦"},{name:"страдальческое лицо",alt:"😧"},{name:"испуганное лицо",alt:"😨"},{name:"встревоженное лицо",alt:"😰"},{name:"грустное, но испытывающее облегчение лицо",alt:"😥"},{name:"плачущее лицо",alt:"😢"},{name:"громко рыдающее лицо",alt:"😭"},{name:"лицо, кричащее от страха",alt:"😱"},{name:"смущенное лицо",alt:"😖"},{name:"упорствующее лицо",alt:"😣"},{name:"разочарованное лицо",alt:"😞"},{name:"удрученное лицо",alt:"😓"},{name:"утомленное лицо",alt:"😩"},{name:"усталое лицо",alt:"😫"},{name:"зевающее лицо",alt:"🥱"},{name:"лицо с паром из ноздрей",alt:"😤"},{name:"надутое лицо, кривящее губы",alt:"😡"},{name:"злое лицо",alt:"😠"},{name:"лицо, выражающееся нецензурно",alt:"🤬"},{name:"какашка",alt:"💩"},{name:"чертик со злым лицом",alt:"👿"},{name:"улыбающийся чертенок",alt:"😈"},{name:"смеющаяся кошачья мордочка",alt:"😺"},{name:"хохочущая кошачья мордочка со смеющимися глазами",alt:"😸"},{name:"кошачья мордочка со слезами радости",alt:"😹"},{name:"смеющаяся кошачья мордочка с глазами в виде сердечек",alt:"😻"},{name:"ухмыляющаяся кошачья мордочка",alt:"😼"},{name:"кошачья мордочка, посылающая поцелуй",alt:"😽"},{name:"изумленная кошачья мордочка",alt:"🙀"},{name:"плачущая кошачья мордочка",alt:"😿"},{name:"хмурая кошачья мордочка",alt:"😾"},{name:"ок",alt:"👌"},{name:"знак победы",alt:"✌️"},{name:"скрещенные на удачу пальцы",alt:"🤞"},{name:"указательный палец, поднятый вверх",alt:"☝️"},{name:"большой палец вверх",alt:"👍"},{name:"большой палец вниз",alt:"👎"},{name:"аплодисменты",alt:"👏"},{name:"рукопожатие",alt:"🤝"}],Ie={class:"emojis__item"},Re=["aria-label"],De=r({__name:"EmojiItem",props:{emoji:null,index:null},setup(a){const s=a,e=c(!1),t=()=>e.value=!0,n=()=>e.value=!1,d=b(()=>`background-position: left -${s.index*(e.value?40:32)}px center`),h=b(()=>`Эмодзи: ${s.emoji.name}`),y=L(K),f=L(I),v=g=>{y(g),f()};return(g,o)=>(l(),m("li",Ie,[u("button",{class:"emojis__btn","aria-label":_(h),style:H(_(d)),onMouseenter:t,onMouseleave:n,onFocus:t,onBlur:n,onClick:o[0]||(o[0]=w=>v(a.emoji.alt))},null,44,Re)]))}});const We={class:"emojis__list"},He=r({__name:"EmojiList",setup(a){return(s,e)=>(l(),m("ul",We,[(l(!0),m(S,null,F(_(Oe),(t,n)=>(l(),C(De,{key:n,emoji:t,index:n},null,8,["emoji","index"]))),128))]))}});const Fe=r({__name:"EmojiListCloseButton",setup(a){const s=L(I);return(e,t)=>(l(),m("div",null,[u("button",{onClick:t[0]||(t[0]=(...n)=>_(s)&&_(s)(...n)),"aria-label":"Закрыть окно с эмодзи",class:"emojis__close"}," x ")]))}});const Je={key:0,class:"emojis"},Ke=r({__name:"EmojisContainer",setup(a){const s=c(!1),e=()=>s.value=!s.value,t=c(),n=()=>s.value=!1;return te(t,n),ne(t,n),O(I,n),(d,h)=>(l(),m("div",{ref_key:"emojisWindowRef",ref:t,class:"new-msg-form__emoji-block"},[i(Le,{isWindowOpened:s.value,onClicked:e},null,8,["isWindowOpened"]),i(J,null,{default:A(()=>[s.value?(l(),m("div",Je,[i(He),i(Fe)])):k("",!0)]),_:1})],512))}});function Ue(a,s,e){const t=c(!0);M(a,()=>{a.value.length&&n()});const n=()=>{t.value===!0&&(s==null||s.send(JSON.stringify({type:"user-typing",room:e==null?void 0:e.name,token:localStorage.token})),t.value=!1,setTimeout(()=>{t.value=!0},1e3))}}function Ve(a,s){const e=c(-1);return M(a,()=>{e.value>=0&&(s.value.textRef.selectionStart=e.value,s.value.textRef.selectionEnd=e.value,s.value.textRef.focus(),e.value=-1)}),e}const ze={class:"new-msg-form"},Pe=r({__name:"NewMessageContainer",props:{room:null,socket:null},setup(a){const s=a,e=c(""),t=c(),n=Ve(e,t);M(()=>s.socket,v=>{v&&Ue(e,s.socket,s.room)});const d=b(()=>e.value.length>0),h=v=>{e.value=v.trim()},y=()=>{var v,g;(g=s.socket)==null||g.send(JSON.stringify({type:"message",token:localStorage.token,message:e.value,room:(v=s.room)==null?void 0:v.name})),e.value=""};return O(K,v=>{const g=t.value.textRef.selectionStart;n.value=g+2;const o=e.value.slice(0,g)+v+e.value.slice(g);e.value=o}),(v,g)=>(l(),m("div",ze,[i(Te,{value:e.value,ref_key:"textareaRef",ref:t,onChanged:g[0]||(g[0]=o=>h(o))},null,8,["value"]),i(Ke),i(Se,{isActive:_(d),onClicked:y},null,8,["isActive"])]))}});function Ge(a,s){const e=c(!0);P(()=>{!e.value&&s.value&&(s.value.scrollTop=s.value.scrollHeight,e.value=!0)}),M(a,()=>{e.value=!1})}const qe=["onSubmit"],Qe=r({__name:"RoomPasswordFormContainer",props:{room:null,socket:null,isLoading:{type:Boolean},passwordError:null},emits:["loading","updated"],setup(a,{emit:s}){const e=a,t=c(""),n=b(()=>t.value.length>7&&!e.passwordError&&!e.isLoading),d=y=>{t.value=y,s("updated")},h=()=>{var y,f;s("loading",!0),(f=e.socket)==null||f.send(JSON.stringify({type:"user-joined",room:(y=e.room)==null?void 0:y.name,password:t.value,token:localStorage.token}))};return O(W,[t,d]),(y,f)=>(l(),m(S,null,[i(le,{title:"Доступ в этот чат защищен паролем"}),i(oe),u("form",{onSubmit:G(h,["prevent"])},[i(Z,{title:"Пароль",name:"password",injectionKey:_(W),error:a.passwordError},null,8,["injectionKey","error"]),i(ee,{title:"Войти",type:"submit",isFullWidth:"",isActive:_(n),isLoading:a.isLoading},null,8,["isActive","isLoading"])],40,qe)],64))}});function Xe(a,s,e,t,n,d,h,y){const{addNotification:f}=q();a.private||(e.value=!0),s.value=new WebSocket("ws://127.0.0.1:8090"),s.value.onopen=()=>{var v;s.value.onmessage=g=>{var w,T,N;const o=JSON.parse(g.data);if(o.type==="401")localStorage.removeItem("token"),localStorage.removeItem("user"),B.push("/enter");else if(o.type==="404")f("Чат не найден","warning"),B.push("/");else if(o.type==="500")f("Ошибка на стороне сервера","warning"),B.push("/");else if(o.type==="access-denied")y.value="Неверный пароль",e.value=!1;else if(o.type==="welcome")e.value=!1,t.value=o.messages,n.value=o.members;else if(o.type==="user-join"){n.value=o.members;const $="join-"+Date.now();t.value=(w=t.value)==null?void 0:w.concat({...o.message,id:$})}else if(o.type==="user-leave"){const $="leave-"+Date.now();t.value=(T=t.value)==null?void 0:T.concat({...o.message,id:$}),n.value=o.members}else if(o.type==="message-broadcast"){const $="msg-"+Date.now();t.value=(N=t.value)==null?void 0:N.concat({...o.message,id:$})}else o.type==="user-typing"&&(d.value=o.user,h.value=!0,setTimeout(()=>h.value=!1,1500))},a.private||(v=s.value)==null||v.send(JSON.stringify({type:"user-joined",room:a.name,token:localStorage.token,password:""}))}}const Ye={key:0,class:"typing__wrapper"},Ze={class:"typing__event"},ea=r({__name:"TypingComponent",props:{userTyping:null,isTyping:{type:Boolean}},setup(a){return(s,e)=>a.isTyping?(l(),m("div",Ye,[u("div",Ze,[u("span",null,x(a.userTyping)+" печатает",1)])])):k("",!0)}});const aa={key:0,class:"chat__messages chat__messages--empty"},sa={key:1,class:"chat__messages"},ta={key:2,class:"chat__messages chat__messages--empty"},na=u("span",null,"Пока нет сообщений",-1),la=[na],oa=r({__name:"RoomContainer",setup(a){const s=c(),e=Y(),t=c(),n=c(),d=c(),{makeApiCall:h,response:y}=ae(),f=c(!1),v=c(""),g=c(!1),o=c(""),w=c(),T=p=>f.value=p,N=()=>o.value="";Q(()=>{h({type:"GET",url:`/rooms/${e.params.slug}`})}),Ge(n,w),M(y,p=>{p!=null&&p.room&&(t.value=p.room,document.title=`Чат "${p.room.name}"`)}),M(t,p=>{p&&Xe(p,s,f,n,d,v,g,o)}),X(()=>{var p;return(p=s.value)==null?void 0:p.close()});const $=b(()=>{var p;return n.value?n.value.filter(E=>E.type==="message").length:(p=t.value)==null?void 0:p.messages});return(p,E)=>{var R;return l(),m(S,null,[i(_e,{room:t.value,members:d.value,msgNum:_($)},null,8,["room","members","msgNum"]),!t.value||!t.value.private&&f.value?(l(),m("div",aa,[i(se,{isColored:"",isLarge:""})])):k("",!0),(R=t.value)!=null&&R.private&&!n.value?(l(),m("div",sa,[i(Qe,{room:t.value,socket:s.value,isLoading:f.value,passwordError:o.value,onUpdated:N,onLoading:E[0]||(E[0]=U=>T(U))},null,8,["room","socket","isLoading","passwordError"])])):k("",!0),n.value&&!n.value.length?(l(),m("div",ta,la)):k("",!0),n.value&&n.value.length>0?(l(),m("div",{key:3,class:"chat__messages",ref_key:"windowRef",ref:w},[i(Ce,{messages:n.value,members:d.value},null,8,["messages","members"])],512)):k("",!0),i(J,{name:"msg"},{default:A(()=>[i(ea,{userTyping:v.value,isTyping:g.value},null,8,["userTyping","isTyping"])]),_:1}),i(Pe,{room:t.value,socket:s.value},null,8,["room","socket"])],64)}}});const va=r({__name:"RoomView",setup(a){return(s,e)=>(l(),C(V,{isFullWidth:"",isFullHeight:""},{default:A(()=>[i(oa)]),_:1}))}});export{va as default};
