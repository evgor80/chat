import{_ as T}from"./CardComponent.vue_vue_type_style_index_0_lang-5b0029ab.js";import{s as w,a as R,_ as D}from"./LoaderComponent.vue_vue_type_style_index_0_lang-07c726db.js";import{d as m,o,c as a,a as _,u as v,b as S,e as B,F as C,i as N,f as l,t as $,r as V,g as f,w as x,T as F,h as O,j as H,n as J,k as j,l as K,m as W,p as q,q as I}from"./index-8b280c30.js";import{_ as b}from"./_plugin-vue_export-helper-c27b6911.js";import{u as z,a as E}from"./useBlurHandle-29fc9f62.js";const M=["value"],U=m({__name:"HomeHeadSearchInput",props:{value:null},setup(s){return(e,t)=>(o(),a("input",{class:"search__input",type:"text",name:"search",id:"search",placeholder:"Искать чат",value:s.value,onInput:t[0]||(t[0]=n=>e.$emit("changed",n.target.value))},null,40,M))}});const X={};function A(s,e){return o(),a("button",{class:"search__reset-btn",onClick:e[0]||(e[0]=t=>s.$emit("clicked")),"aria-label":"Сбросить поиск"}," X ")}const G=b(X,[["render",A]]),P=m({__name:"HomeHeadSearchContainer",setup(s){const[e,t]=N(w);return(n,r)=>(o(),a(C,null,[_(U,{value:v(e),onChanged:r[0]||(r[0]=u=>v(t)(u))},null,8,["value"]),v(e)?(o(),S(G,{key:0,onClicked:r[1]||(r[1]=u=>v(t)(""))})):B("",!0)],64))}});const Q={},Y=l("i",{class:"fa fa-sort-amount-up"},null,-1),Z=[Y];function ee(s,e){return o(),a("button",{class:"search__sort__icon",onClick:e[0]||(e[0]=t=>s.$emit("clicked")),"aria-label":"Сортировать чаты"},Z)}const te=b(Q,[["render",ee]]),se={class:"search__sort__item"},oe=m({__name:"HomeHeadSortItem",props:{type:null,title:null},setup(s){return(e,t)=>(o(),a("li",se,[l("button",{class:"search__sort__btn",onClick:t[0]||(t[0]=n=>e.$emit("clicked",s.type))},$(s.title),1)]))}});const ne={class:"search__sort__container"},ae=m({__name:"HomeHeadSortList",setup(s){const e=[{title:"По умолчанию",type:"default"},{title:"По количеству участников",type:"members"},{title:"По количеству сообщений",type:"messages"},{title:"По типу чата",type:"type"}],t=N(R);return(n,r)=>(o(),a("ul",ne,[(o(),a(C,null,V(e,u=>_(oe,{key:u.type,title:u.title,type:u.type,onClicked:r[0]||(r[0]=y=>{v(t)(y),n.$emit("clicked")})},null,8,["title","type"])),64))]))}});const re=m({__name:"HomeHeadSortContainer",setup(s){const e=f(!1),t=f(),n=()=>e.value=!e.value,r=()=>e.value=!1;return z(t,r),E(t,r),(u,y)=>(o(),a("div",{ref_key:"divRef",ref:t},[_(te,{name:"head",onClicked:n}),_(F,null,{default:x(()=>[e.value?(o(),S(ae,{key:0,onClicked:n})):B("",!0)]),_:1})],512))}});const le=b(re,[["__scopeId","data-v-63fa7e17"]]),_e={class:"search"},ce={class:"search__body"},ie=m({__name:"HomeHead",setup(s){return(e,t)=>(o(),a("div",_e,[l("div",ce,[_(P),_(le)])]))}});const ue={class:"room"},me={class:"room__name"},de={class:"room__details"},pe=l("i",{class:"fas fa-users"},null,-1),ve=l("i",{class:"fas fa-comment"},null,-1),fe=m({__name:"RoomItem",props:{room:null},setup(s){const e=s,t=e.room.private?"fa-user-lock":"fa-lock-open",n=e.room.private?" Закрытый":" Общий",r=`/rooms/${e.room.slug}`;return(u,y)=>{const L=O("RouterLink");return o(),a("li",ue,[_(L,{to:r,class:"room__link"},{default:x(()=>[l("div",me,[l("span",null,$(s.room.name),1)]),l("div",de,[l("span",null,[pe,H(" "+$(s.room.members),1)]),l("span",null,[ve,H(" "+$(s.room.messages),1)]),l("span",null,[l("i",{class:J([v(t),"fa"])},null,2),H(" "+$(v(n)),1)])])]),_:1})])}}});const ye={key:0,class:"rooms-list rooms-list--empty"},he=l("span",null,"Нет чатов",-1),ke=[he],ge={key:1,class:"rooms-list"},$e={key:2,class:"rooms-list rooms-list--empty"},He={key:3,class:"rooms-list rooms-list--empty"},Se=m({__name:"RoomList",props:{list:null,isLoading:{type:Boolean}},setup(s){return(e,t)=>s.list&&s.list.length===0?(o(),a("div",ye,ke)):s.list&&s.list.length?(o(),a("ul",ge,[(o(!0),a(C,null,V(s.list,n=>(o(),S(fe,{key:n.id,room:n},null,8,["room"]))),128))])):s.isLoading?(o(),a("div",$e,[_(D,{isColored:"",isLarge:""})])):(o(),a("div",He," Не удалось получить данные с сервера "))}});const Ce={},xe={class:"new-room"};function be(s,e){const t=O("RouterLink");return o(),a("div",xe,[_(t,{class:"button",to:"/new-chat"},{default:x(()=>[H(" Создать чат ")]),_:1})])}const Le=b(Ce,[["render",be]]),Ie=m({__name:"HomeContainer",setup(s){const e=f(),t=f(""),n=f(),r=f(!0),u=c=>{t.value=c},y=j(()=>{var c;return t.value?(c=e.value)==null?void 0:c.filter(i=>i.name.toLowerCase().match(t.value.trim().toLowerCase())):e.value});K(()=>{n.value=new WebSocket("ws://127.0.0.1:8090"),n.value.onopen=()=>{n.value.send(JSON.stringify({type:"all-rooms",token:localStorage.token})),n.value.send(JSON.stringify({type:"update",token:localStorage.token}))},n.value.onmessage=c=>{var h;const i=JSON.parse(c.data);i.type==="all"?(r.value=!1,e.value=i.rooms):i.type==="update"?e.value=(h=e.value)==null?void 0:h.map(k=>{var g;return k.id===((g=i.room)==null?void 0:g.id)?i.room:k}):i.type==="401"&&(localStorage.removeItem("token"),localStorage.removeItem("user"),W.push("/enter"))}}),q(()=>{var c;return(c=n.value)==null?void 0:c.close()});function L(c){var i,h,k,g;switch(c){case"default":e.value=(i=e.value)==null?void 0:i.sort((d,p)=>d.created_at>p.created_at?1:p.created_at>d.created_at?-1:0);break;case"type":e.value=(h=e.value)==null?void 0:h.sort((d,p)=>d.private-p.private);break;case"members":e.value=(k=e.value)==null?void 0:k.sort((d,p)=>p.members-d.members);break;case"messages":e.value=(g=e.value)==null?void 0:g.sort((d,p)=>p.messages-d.messages);break}}return I(w,[t,u]),I(R,L),(c,i)=>(o(),a(C,null,[_(ie),_(Se,{list:v(y),isLoading:r.value},null,8,["list","isLoading"]),_(Le)],64))}}),Oe=m({__name:"HomeView",setup(s){return(e,t)=>(o(),S(T,{isFullHeight:""},{default:x(()=>[_(Ie)]),_:1}))}});export{Oe as default};
